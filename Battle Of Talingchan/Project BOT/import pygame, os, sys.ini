import pygame, os, sys

pygame.init()
screen = pygame.display.set_mode((1100, 700))
pygame.display.set_caption("Battle of Talingchan ‚Äì Card Engine v2")
font = pygame.font.Font(None, 32)

# ------------------------
# ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏´‡∏•‡∏±‡∏Å
# ------------------------
player_life = 5
enemy_life = 5
selected_card = None

# ------------------------
# ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ
# ------------------------
def deal_damage(amount):
    global enemy_life
    enemy_life = max(enemy_life - amount, 0)
    print(f"‡∏®‡∏±‡∏ï‡∏£‡∏π‡πÄ‡∏™‡∏µ‡∏¢‡∏û‡∏•‡∏±‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï {amount} ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ {enemy_life}")

def heal_self(amount):
    global player_life
    player_life += amount
    print(f"‡∏ü‡∏∑‡πâ‡∏ô‡∏û‡∏•‡∏±‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï {amount} ‡∏£‡∏ß‡∏°‡πÄ‡∏õ‡πá‡∏ô {player_life}")

# ------------------------
# ‡∏Ñ‡∏•‡∏≤‡∏™‡∏Å‡∏≤‡∏£‡πå‡∏î
# ------------------------
class Card:
    def __init__(self, name, power, cost, desc, effect_code, image):
        self.name = name
        self.power = int(power)
        self.cost = int(cost)
        self.description = desc
        self.effect_code = effect_code
        self.image = image
        self.rect = self.image.get_rect()

    def activate_effect(self):
        """‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡πÇ‡∏Ñ‡πâ‡∏î‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå txt"""
        try:
            exec(self.effect_code, globals())
        except Exception as e:
            print(f"‚ùå Error executing effect: {e}")

# ------------------------
# ‡πÇ‡∏´‡∏•‡∏î‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏à‡∏≤‡∏Å‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå
# ------------------------
def load_cards():
    folder = "cards"
    cards = []
    for file in os.listdir(folder):
        if file.endswith(".txt"):
            path = os.path.join(folder, file)
            with open(path, "r", encoding="utf-8") as f:
                data = {}
                for line in f:
                    if "=" in line:
                        key, val = line.strip().split("=", 1)
                        data[key] = val
            img_name = file.replace(".txt", ".png")
            img_path = os.path.join(folder, img_name)
            if os.path.exists(img_path):
                image = pygame.image.load(img_path).convert_alpha()
                image = pygame.transform.scale(image, (240, 320))
            else:
                image = pygame.Surface((240, 320))
                image.fill((180, 180, 180))
            cards.append(Card(
                data.get("name", "Unknown"),
                data.get("power", 0),
                data.get("cost", 0),
                data.get("description", ""),
                data.get("effect_code", ""),
                image
            ))
    return cards

cards = load_cards()

# ------------------------
# ‡∏à‡∏±‡∏î‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
# ------------------------
for i, card in enumerate(cards):
    card.rect.topleft = (100 + i * 260, 350)

# ------------------------
# Loop ‡∏´‡∏•‡∏±‡∏Å
# ------------------------
running = True
while running:
    screen.fill((30, 35, 40))

    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            pygame.quit()
            sys.exit()

        elif event.type == pygame.MOUSEBUTTONDOWN:
            pos = event.pos
            for c in cards:
                if c.rect.collidepoint(pos):
                    selected_card = c
                    print(f"üÉè ‡πÄ‡∏•‡πà‡∏ô‡∏Å‡∏≤‡∏£‡πå‡∏î {c.name} (Power {c.power})")
                    c.activate_effect()

    # ‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    for c in cards:
        screen.blit(c.image, c.rect)

    # ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡πå‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
    if selected_card:
        text1 = font.render(f"‡∏ä‡∏∑‡πà‡∏≠: {selected_card.name}", True, (255, 255, 255))
        text2 = font.render(f"‡∏û‡∏•‡∏±‡∏á: {selected_card.power} | ‡∏Ñ‡πà‡∏≤‡∏£‡πà‡∏≤‡∏¢: {selected_card.cost}", True, (255, 255, 255))
        text3 = font.render(f"‡πÄ‡∏≠‡∏ü‡πÄ‡∏ü‡∏Å‡∏ï‡πå: {selected_card.description}", True, (255, 255, 0))
        screen.blit(text1, (50, 50))
        screen.blit(text2, (50, 80))
        screen.blit(text3, (50, 110))

    # ‡∏û‡∏•‡∏±‡∏á‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï
    life_text = font.render(f"Life ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô: {player_life} | Life ‡∏®‡∏±‡∏ï‡∏£‡∏π: {enemy_life}", True, (0, 255, 0))
    screen.blit(life_text, (700, 50))

    pygame.display.flip()
